{% extends "base.html" %}

{% block title %}Setup - Fantasy Football ML Draft System{% endblock %}

{% block content %}
<div class="grid">
    <!-- System Status Card -->
    <div class="card">
        <h3>System Status</h3>
        <div id="system-status">
            <div class="loading">
                <div class="spinner"></div>
                <p>Checking system status...</p>
            </div>
        </div>
    </div>

    <!-- Model Training Card -->
    <div class="card">
        <h3>Model Training</h3>
        <p>Train ML models using historical data to generate accurate projections.</p>
        <button id="train-models-btn" class="btn" onclick="trainModels()">
            Train Models
        </button>
        <div id="training-status"></div>
    </div>

    <!-- Generate Projections Card -->
    <div class="card">
        <h3>Generate Projections</h3>
        <p>Generate 2025 player projections using trained models.</p>
        <button id="generate-projections-btn" class="btn" onclick="generateProjections()">
            Generate 2025 Projections
        </button>
        <div id="projections-status"></div>
    </div>
</div>

<!-- Quick Start Guide -->
<div class="card">
    <h3>Quick Start Guide</h3>
    <div class="grid grid-2">
        <div>
            <h4>First Time Setup</h4>
            <ol style="padding-left: 20px; line-height: 1.8;">
                <li><strong>Train Models:</strong> Click "Train Models" to train ML algorithms on historical data</li>
                <li><strong>Generate Projections:</strong> Create 2025 player projections using trained models</li>
                <li><strong>Configure Settings:</strong> Set your league settings (teams, scoring, etc.)</li>
                <li><strong>Start Drafting:</strong> Use the Draft page for simulation or live assistance</li>
            </ol>
        </div>
        <div>
            <h4>Features Overview</h4>
            <ul style="padding-left: 20px; line-height: 1.8;">
                <li><strong>ML Models:</strong> XGBoost, Random Forest, Gradient Boosting ensemble</li>
                <li><strong>AI Advisor:</strong> Claude-powered chat for personalized advice</li>
                <li><strong>Draft Modes:</strong> Simulation, manual entry, Sleeper integration</li>
                <li><strong>Analytics:</strong> VBD calculations, tier rankings, team analysis</li>
            </ul>
        </div>
    </div>
</div>

<!-- Feature Cards -->
<div class="grid grid-3">
    <div class="card" style="text-align: center;">
        <div style="font-size: 3em; margin-bottom: 15px;">üìä</div>
        <h4>Player Rankings</h4>
        <p>View ML-generated player rankings with VBD scores and tier classifications.</p>
        <a href="/rankings" class="btn">View Rankings</a>
    </div>
    
    <div class="card" style="text-align: center;">
        <div style="font-size: 3em; margin-bottom: 15px;">üèà</div>
        <h4>Draft Assistant</h4>
        <p>Real-time draft recommendations with multiple input modes and CPU simulation.</p>
        <a href="/draft" class="btn">Start Draft</a>
    </div>
    
    <div class="card" style="text-align: center;">
        <div style="font-size: 3em; margin-bottom: 15px;">ü§ñ</div>
        <h4>AI Advisor</h4>
        <p>Chat with Claude AI for personalized fantasy football strategy and advice.</p>
        <a href="/advice" class="btn btn-ai">Get Advice</a>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Page-specific JavaScript for setup/index page
document.addEventListener('DOMContentLoaded', function() {
    loadSystemStatusDetails();
});

// Override the system status update to show detailed info on this page
window.onSystemStatusUpdate = function(status) {
    updateDetailedSystemStatus(status);
};

async function loadSystemStatusDetails() {
    try {
        const response = await fetch('/api/status');
        const data = await response.json();
        updateDetailedSystemStatus(data);
    } catch (error) {
        console.error('Error loading system status:', error);
        document.getElementById('system-status').innerHTML = 
            '<div class="alert alert-error">Error checking system status</div>';
    }
}

function updateDetailedSystemStatus(status) {
    const statusDiv = document.getElementById('system-status');
    let statusHtml = '';
    
    // System components status
    statusHtml += createStatusItem('System Initialized', status.system_initialized);
    statusHtml += createStatusItem('Models Trained', status.models_trained);
    statusHtml += createStatusItem('Projections Ready', status.projections_ready);
    statusHtml += createStatusItem('AI Advisor Available', status.claude_api_available);
    
    // League settings summary
    if (status.league_settings) {
        const settings = status.league_settings;
        statusHtml += '<div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.2);">';
        statusHtml += '<h4 style="color: #ffd700; margin-bottom: 10px;">League Configuration</h4>';
        statusHtml += `<div>Teams: ${settings.teams || 12} | Scoring: ${settings.scoring || 'PPR'}</div>`;
        statusHtml += '</div>';
    }
    
    statusDiv.innerHTML = statusHtml;
    
    // Update button states
    const trainBtn = document.getElementById('train-models-btn');
    const projectionsBtn = document.getElementById('generate-projections-btn');
    
    if (trainBtn) trainBtn.disabled = !status.system_initialized;
    if (projectionsBtn) projectionsBtn.disabled = !status.models_trained;
}

function createStatusItem(label, isActive) {
    const statusClass = isActive ? 'status-success' : 'status-warning';
    const statusText = isActive ? 'Yes' : 'No';
    return `
        <div style="margin-bottom: 10px;">
            <span class="status-indicator ${statusClass}"></span>
            ${label}: ${statusText}
        </div>
    `;
}
</script>
{% endblock %}